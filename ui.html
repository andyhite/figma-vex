<!DOCTYPE html>
<html>
<head>
  <style>
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      font-family: Inter, -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      font-size: 12px;
      color: #333;
      padding: 16px;
      background: #fff;
    }

    h2 {
      font-size: 14px;
      font-weight: 600;
      margin-bottom: 12px;
      color: #000;
    }

    h3 {
      font-size: 12px;
      font-weight: 600;
      margin: 16px 0 8px;
      color: #333;
    }

    .tabs {
      display: flex;
      gap: 0;
      margin-bottom: 16px;
      border-bottom: 1px solid #e5e5e5;
    }

    .tab {
      padding: 8px 16px;
      border: none;
      background: none;
      cursor: pointer;
      font-size: 12px;
      font-weight: 500;
      color: #666;
      border-bottom: 2px solid transparent;
      margin-bottom: -1px;
    }

    .tab:hover {
      color: #333;
    }

    .tab.active {
      color: #18a0fb;
      border-bottom-color: #18a0fb;
    }

    .tab-content {
      display: none;
    }

    .tab-content.active {
      display: block;
    }

    .form-group {
      margin-bottom: 12px;
    }

    label {
      display: flex;
      align-items: center;
      gap: 8px;
      cursor: pointer;
      margin-bottom: 6px;
    }

    label.text-label {
      display: block;
      margin-bottom: 4px;
      font-weight: 500;
    }

    input[type="checkbox"] {
      width: 14px;
      height: 14px;
      cursor: pointer;
    }

    input[type="text"] {
      width: 100%;
      padding: 8px;
      border: 1px solid #e5e5e5;
      border-radius: 4px;
      font-size: 12px;
      font-family: 'SF Mono', Monaco, 'Courier New', monospace;
    }

    input[type="text"]:focus {
      outline: none;
      border-color: #18a0fb;
    }

    .output-area {
      width: 100%;
      height: 200px;
      padding: 12px;
      border: 1px solid #e5e5e5;
      border-radius: 4px;
      font-family: 'SF Mono', Monaco, 'Courier New', monospace;
      font-size: 11px;
      line-height: 1.5;
      resize: vertical;
      background: #fafafa;
    }

    .output-area:focus {
      outline: none;
      border-color: #18a0fb;
    }

    .button-row {
      display: flex;
      gap: 8px;
      margin-top: 12px;
    }

    button {
      padding: 8px 16px;
      border-radius: 6px;
      font-size: 12px;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.15s ease;
    }

    .btn-primary {
      background: #18a0fb;
      color: #fff;
      border: none;
    }

    .btn-primary:hover {
      background: #0d8de5;
    }

    .btn-secondary {
      background: #fff;
      color: #333;
      border: 1px solid #e5e5e5;
    }

    .btn-secondary:hover {
      background: #f5f5f5;
    }

    .btn-success {
      background: #1bc47d;
      color: #fff;
      border: none;
    }

    .help-section {
      margin-top: 20px;
      padding: 12px;
      background: #f5f5f5;
      border-radius: 6px;
    }

    .help-section h4 {
      font-size: 11px;
      font-weight: 600;
      margin-bottom: 8px;
      color: #666;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    .help-section code {
      display: inline-block;
      background: #e5e5e5;
      padding: 2px 6px;
      border-radius: 3px;
      font-family: 'SF Mono', Monaco, 'Courier New', monospace;
      font-size: 10px;
    }

    .help-section ul {
      list-style: none;
      font-size: 11px;
      color: #666;
    }

    .help-section li {
      margin-bottom: 4px;
    }

    .status {
      margin-top: 8px;
      font-size: 11px;
      color: #666;
    }

    .status.success {
      color: #1bc47d;
    }

    .status.error {
      color: #f24822;
    }

    .collections-list {
      max-height: 150px;
      overflow-y: auto;
      border: 1px solid #e5e5e5;
      border-radius: 4px;
      padding: 8px;
      background: #fafafa;
      margin-top: 8px;
    }

    .collections-list label {
      display: flex;
      align-items: center;
      padding: 4px 0;
      font-size: 11px;
    }

    .collections-list input[type="checkbox"] {
      margin-right: 6px;
    }

    .scrollable {
      max-height: 200px;
      overflow-y: auto;
    }
  </style>
</head>
<body>
  <h2>Variables Export</h2>

  <div class="tabs">
    <button class="tab active" data-tab="css">CSS</button>
    <button class="tab" data-tab="scss">SCSS</button>
    <button class="tab" data-tab="json">JSON</button>
    <button class="tab" data-tab="typescript">TypeScript</button>
    <button class="tab" data-tab="help">Help</button>
  </div>

  <div id="css-tab" class="tab-content active">
    <h3>Options</h3>

    <div class="form-group">
      <label class="text-label">CSS Selector</label>
      <input type="text" id="css-selector" value=":root" />
    </div>

    <div class="form-group">
      <label class="text-label">Variable Prefix (optional)</label>
      <input type="text" id="css-prefix" placeholder="e.g., ds, theme" />
    </div>

    <div class="form-group">
      <label class="text-label">Collections</label>
      <div class="collections-list" id="css-collections">
        <div style="color: #666; font-size: 11px;">Loading collections...</div>
      </div>
    </div>

    <div class="form-group">
      <label>
        <input type="checkbox" id="css-useModesAsSelectors" />
        Export modes as separate selectors
      </label>
    </div>

    <div class="form-group">
      <label>
        <input type="checkbox" id="css-includeCollectionComments" checked />
        Include collection comments
      </label>
    </div>

    <div class="form-group">
      <label>
        <input type="checkbox" id="css-includeModeComments" checked />
        Include mode comments
      </label>
    </div>

    <div class="button-row">
      <button class="btn-primary" id="export-css">Generate CSS</button>
    </div>

    <h3>Output</h3>
    <textarea class="output-area" id="css-output" readonly placeholder="Click 'Generate CSS' to export variables..."></textarea>

    <div class="button-row">
      <button class="btn-secondary" id="copy-css">Copy to Clipboard</button>
      <button class="btn-secondary" id="download-css">Download</button>
    </div>

    <div class="status" id="css-status"></div>
  </div>

  <div id="scss-tab" class="tab-content">
    <h3>Options</h3>

    <div class="form-group">
      <label class="text-label">Variable Prefix (optional)</label>
      <input type="text" id="scss-prefix" placeholder="e.g., ds, theme" />
    </div>

    <div class="form-group">
      <label class="text-label">Collections</label>
      <div class="collections-list" id="scss-collections">
        <div style="color: #666; font-size: 11px;">Loading collections...</div>
      </div>
    </div>

    <div class="form-group">
      <label>
        <input type="checkbox" id="scss-includeCollectionComments" checked />
        Include collection comments
      </label>
    </div>

    <div class="button-row">
      <button class="btn-primary" id="export-scss">Generate SCSS</button>
    </div>

    <h3>Output</h3>
    <textarea class="output-area" id="scss-output" readonly placeholder="Click 'Generate SCSS' to export variables..."></textarea>

    <div class="button-row">
      <button class="btn-secondary" id="copy-scss">Copy to Clipboard</button>
      <button class="btn-secondary" id="download-scss">Download</button>
    </div>

    <div class="status" id="scss-status"></div>
  </div>

  <div id="json-tab" class="tab-content">
    <p style="margin-bottom: 12px; color: #666;">
      Export as JSON for use with Style Dictionary or other token tools.
    </p>

    <div class="form-group">
      <label class="text-label">Collections</label>
      <div class="collections-list" id="json-collections">
        <div style="color: #666; font-size: 11px;">Loading collections...</div>
      </div>
    </div>

    <div class="button-row">
      <button class="btn-primary" id="export-json">Generate JSON</button>
    </div>

    <h3>Output</h3>
    <textarea class="output-area" id="json-output" readonly placeholder="Click 'Generate JSON' to export variables..."></textarea>

    <div class="button-row">
      <button class="btn-secondary" id="copy-json">Copy to Clipboard</button>
      <button class="btn-secondary" id="download-json">Download</button>
    </div>

    <div class="status" id="json-status"></div>
  </div>

  <div id="typescript-tab" class="tab-content">
    <p style="margin-bottom: 12px; color: #666;">
      Generate TypeScript type definitions for CSS custom properties.
    </p>

    <div class="form-group">
      <label class="text-label">Variable Prefix (optional)</label>
      <input type="text" id="ts-prefix" placeholder="e.g., ds, theme" />
    </div>

    <div class="form-group">
      <label class="text-label">Collections</label>
      <div class="collections-list" id="ts-collections">
        <div style="color: #666; font-size: 11px;">Loading collections...</div>
      </div>
    </div>

    <div class="button-row">
      <button class="btn-primary" id="export-typescript">Generate TypeScript</button>
    </div>

    <h3>Output</h3>
    <textarea class="output-area" id="typescript-output" readonly placeholder="Click 'Generate TypeScript' to export types..."></textarea>

    <div class="button-row">
      <button class="btn-secondary" id="copy-typescript">Copy to Clipboard</button>
      <button class="btn-secondary" id="download-typescript">Download</button>
    </div>

    <div class="status" id="typescript-status"></div>
  </div>

  <div id="help-tab" class="tab-content">
    <div class="help-section">
      <h4>Description Field Format</h4>
      <p style="margin-bottom: 12px; color: #666;">
        Add these instructions to any variable's description field to control export:
      </p>

      <h4 style="margin-top: 12px;">Number Units</h4>
      <ul>
        <li><code>unit: none</code> — Output raw number (e.g., 1.5 for line-height)</li>
        <li><code>unit: px</code> — Output with px (default)</li>
        <li><code>unit: rem</code> — Convert to rem (16px base)</li>
        <li><code>unit: rem:20</code> — Convert to rem with custom base</li>
        <li><code>unit: em</code> — Output with em</li>
        <li><code>unit: %</code> — Output as percentage</li>
        <li><code>unit: ms</code> — Output with ms</li>
      </ul>

      <h4 style="margin-top: 12px;">Color Formats</h4>
      <ul>
        <li><code>format: hex</code> — #rrggbb (default)</li>
        <li><code>format: rgb</code> — rgb(r, g, b)</li>
        <li><code>format: rgba</code> — rgba(r, g, b, a)</li>
        <li><code>format: hsl</code> — hsl(h, s%, l%)</li>
        <li><code>format: oklch</code> — oklch(l% c h)</li>
      </ul>

      <h4 style="margin-top: 12px;">Examples</h4>
      <ul>
        <li>Line height: Add <code>unit: none</code> → outputs <code>1.5</code></li>
        <li>Font weight: Add <code>unit: none</code> → outputs <code>700</code></li>
        <li>Z-index: Add <code>unit: none</code> → outputs <code>100</code></li>
        <li>Spacing: Add <code>unit: rem</code> → outputs <code>1rem</code></li>
      </ul>
    </div>
  </div>

  <script>
    let collections = [];

    // Helper function to download file
    function downloadFile(content, filename, mimeType) {
      const blob = new Blob([content], { type: mimeType });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = filename;
      document.body.appendChild(a);
      a.click();
      document.body.removeChild(a);
      URL.revokeObjectURL(url);
    }

    // Helper function to get selected collections
    function getSelectedCollections(prefix) {
      const checkboxes = document.querySelectorAll(`#${prefix}-collections input[type="checkbox"]:checked`);
      return Array.from(checkboxes).map(cb => cb.value);
    }

    // Helper function to render collections
    function renderCollections(containerId, selectedIds = []) {
      const container = document.getElementById(containerId);
      if (collections.length === 0) {
        container.innerHTML = '<div style="color: #666; font-size: 11px;">No collections found</div>';
        return;
      }

      container.innerHTML = collections.map(collection => `
        <label>
          <input type="checkbox" value="${collection.id}" ${selectedIds.includes(collection.id) ? 'checked' : ''} />
          ${collection.name}
        </label>
      `).join('');
    }

    // Tab switching
    document.querySelectorAll('.tab').forEach(tab => {
      tab.addEventListener('click', () => {
        document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
        document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));

        tab.classList.add('active');
        document.getElementById(tab.dataset.tab + '-tab').classList.add('active');
      });
    });

    // Request collections on load
    parent.postMessage({ pluginMessage: { type: 'get-collections' } }, '*');

    // Export CSS
    document.getElementById('export-css').addEventListener('click', () => {
      const selectedCollections = getSelectedCollections('css');
      const options = {
        selector: document.getElementById('css-selector').value || ':root',
        prefix: document.getElementById('css-prefix').value.trim() || undefined,
        useModesAsSelectors: document.getElementById('css-useModesAsSelectors').checked,
        includeCollectionComments: document.getElementById('css-includeCollectionComments').checked,
        includeModeComments: document.getElementById('css-includeModeComments').checked,
        selectedCollections: selectedCollections.length > 0 ? selectedCollections : undefined,
      };

      parent.postMessage({ pluginMessage: { type: 'export-css', options } }, '*');
      document.getElementById('css-status').textContent = 'Generating...';
      document.getElementById('css-status').className = 'status';
    });

    // Export SCSS
    document.getElementById('export-scss').addEventListener('click', () => {
      const selectedCollections = getSelectedCollections('scss');
      const options = {
        selector: ':root',
        prefix: document.getElementById('scss-prefix').value.trim() || undefined,
        includeCollectionComments: document.getElementById('scss-includeCollectionComments').checked,
        includeModeComments: false,
        useModesAsSelectors: false,
        selectedCollections: selectedCollections.length > 0 ? selectedCollections : undefined,
      };

      parent.postMessage({ pluginMessage: { type: 'export-scss', options } }, '*');
      document.getElementById('scss-status').textContent = 'Generating...';
      document.getElementById('scss-status').className = 'status';
    });

    // Export JSON
    document.getElementById('export-json').addEventListener('click', () => {
      const selectedCollections = getSelectedCollections('json');
      const options = {
        selectedCollections: selectedCollections.length > 0 ? selectedCollections : undefined,
      };

      parent.postMessage({ pluginMessage: { type: 'export-json', options } }, '*');
      document.getElementById('json-status').textContent = 'Generating...';
      document.getElementById('json-status').className = 'status';
    });

    // Export TypeScript
    document.getElementById('export-typescript').addEventListener('click', () => {
      const selectedCollections = getSelectedCollections('ts');
      const options = {
        selector: ':root',
        prefix: document.getElementById('ts-prefix').value.trim() || undefined,
        includeCollectionComments: false,
        includeModeComments: false,
        useModesAsSelectors: false,
        selectedCollections: selectedCollections.length > 0 ? selectedCollections : undefined,
      };

      parent.postMessage({ pluginMessage: { type: 'export-typescript', options } }, '*');
      document.getElementById('typescript-status').textContent = 'Generating...';
      document.getElementById('typescript-status').className = 'status';
    });

    // Copy buttons
    document.getElementById('copy-css').addEventListener('click', () => {
      const output = document.getElementById('css-output');
      output.select();
      document.execCommand('copy');
      const status = document.getElementById('css-status');
      status.textContent = 'Copied to clipboard!';
      status.className = 'status success';
    });

    document.getElementById('copy-scss').addEventListener('click', () => {
      const output = document.getElementById('scss-output');
      output.select();
      document.execCommand('copy');
      const status = document.getElementById('scss-status');
      status.textContent = 'Copied to clipboard!';
      status.className = 'status success';
    });

    document.getElementById('copy-json').addEventListener('click', () => {
      const output = document.getElementById('json-output');
      output.select();
      document.execCommand('copy');
      const status = document.getElementById('json-status');
      status.textContent = 'Copied to clipboard!';
      status.className = 'status success';
    });

    document.getElementById('copy-typescript').addEventListener('click', () => {
      const output = document.getElementById('typescript-output');
      output.select();
      document.execCommand('copy');
      const status = document.getElementById('typescript-status');
      status.textContent = 'Copied to clipboard!';
      status.className = 'status success';
    });

    // Download buttons
    document.getElementById('download-css').addEventListener('click', () => {
      const content = document.getElementById('css-output').value;
      if (content) {
        downloadFile(content, 'variables.css', 'text/css');
        const status = document.getElementById('css-status');
        status.textContent = 'Downloaded!';
        status.className = 'status success';
      }
    });

    document.getElementById('download-scss').addEventListener('click', () => {
      const content = document.getElementById('scss-output').value;
      if (content) {
        downloadFile(content, 'variables.scss', 'text/scss');
        const status = document.getElementById('scss-status');
        status.textContent = 'Downloaded!';
        status.className = 'status success';
      }
    });

    document.getElementById('download-json').addEventListener('click', () => {
      const content = document.getElementById('json-output').value;
      if (content) {
        downloadFile(content, 'variables.json', 'application/json');
        const status = document.getElementById('json-status');
        status.textContent = 'Downloaded!';
        status.className = 'status success';
      }
    });

    document.getElementById('download-typescript').addEventListener('click', () => {
      const content = document.getElementById('typescript-output').value;
      if (content) {
        downloadFile(content, 'variables.d.ts', 'text/typescript');
        const status = document.getElementById('typescript-status');
        status.textContent = 'Downloaded!';
        status.className = 'status success';
      }
    });

    // Receive messages from plugin
    window.onmessage = (event) => {
      const msg = event.data.pluginMessage;

      if (msg.type === 'collections-list') {
        collections = msg.collections;
        renderCollections('css-collections');
        renderCollections('scss-collections');
        renderCollections('json-collections');
        renderCollections('ts-collections');
      }

      if (msg.type === 'css-result') {
        document.getElementById('css-output').value = msg.css;
        document.getElementById('css-status').textContent = 'Generated successfully!';
        document.getElementById('css-status').className = 'status success';
      }

      if (msg.type === 'scss-result') {
        document.getElementById('scss-output').value = msg.scss;
        document.getElementById('scss-status').textContent = 'Generated successfully!';
        document.getElementById('scss-status').className = 'status success';
      }

      if (msg.type === 'json-result') {
        document.getElementById('json-output').value = msg.json;
        document.getElementById('json-status').textContent = 'Generated successfully!';
        document.getElementById('json-status').className = 'status success';
      }

      if (msg.type === 'typescript-result') {
        document.getElementById('typescript-output').value = msg.typescript;
        document.getElementById('typescript-status').textContent = 'Generated successfully!';
        document.getElementById('typescript-status').className = 'status success';
      }
    };
  </script>
</body>
</html>
